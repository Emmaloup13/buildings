<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Paris centre BDNB </title>
    <style>
        html {
            height: 100%;
        }

        body {
            margin: 0;
            overflow: hidden;
            height: 100%;
        }

        #viewerDiv {
            margin-top: 0px;
            height: 1000px;
            width: 100%;
            padding: 0;
        }

        canvas {
            display: block
        }

        #form {
            background-color: black;
            color: aqua;
            z-index: 10;
        }

        #all {
            display: flex;
            flex-direction: column;
        }

        #Legend {
            background-color: rgb(202, 194, 198);
            z-index: 10000;
            width: 150px;
            height: fit-content;
            right: 10px;
            top: 10px;
            position: absolute;
            padding: 5px;
            padding-bottom: 15px;
            opacity: 80%;
        }

        .dot {
            height: 15px;
            width: 15px;
            border-radius: 50%;
            display: inline-block;
            margin: 5px;

        }

        h3 {
            text-align: center;
        }

        p {
            display: inline
        }
    </style>
</head>

<body>
    <div id="all">
        <div id="form">
            <form id="buttons" action="">

                <label for="PeriodeConstruction">Période Construction</label>
                <input type="radio" id="PeriodeConstruction" name="layer" value=1 checked>

                <label for="DPEEnergy">DPE Energie</label>
                <input type="radio" id="DPEEnergy" name="layer" value=2>

                <label for="DPEGES">DPE GES</label>
                <input type="radio" id="DPEGES" name="layer" value=3>

                <label for="DateNotationDPE">Date Notation DPE</label>
                <input type="radio" id="DateNotationDPE" name="layer" value=4> <br>

                <label for="ConsommationKw">Consommation Kw/an</label>
                <input type="radio" id="ConsommationKw" name="layer" value=5>

                <label for="ConsommationGas">Consommation Gaz</label>
                <input type="radio" id="ConsommationGas" name="layer" value=6>
            </form>
        </div>
        <div id="Legend">


        </div>



        <div id="hidden" hidden>

            <div id="dateConstruction">
                <h3> Période de Construction </h3>
                <br>
                <span class="dot" style="background-color:#f7fcf5;"></span>
                <p> avant 1948 </p> <br>
                <span class="dot" style="background-color:#e2f4dd;"></span>
                <p> 1949-1970 </p> <br>
                <span class="dot" style="background-color:#e2f4dd;"></span>
                <p> 1970-1988 </p> <br>
                <span class="dot" style="background-color:#94d390;"></span>
                <p> 1989-1999 </p> <br>
                <span class="dot" style="background-color:#60ba6c;"></span>
                <p> 2000-2005 </p> <br>
                <span class="dot" style="background-color:#329b51;"></span>
                <p> 2006-2012 </p> <br>
                <span class="dot" style="background-color:#277a3e;"></span>
                <p> >2012</p> <br>
            </div>


            <div id="dpeEnergy">
                <h3> DPE Energie </h3>
                <br>
                <span class="dot" style="background-color:#009735;"></span>
                <p> A </p> <br>
                <span class="dot" style="background-color:#00ff59;"></span>
                <p> B </p> <br>
                <span class="dot" style="background-color:#a8fa2d;"></span>
                <p> C </p> <br>
                <span class="dot" style="background-color:#f3fa25;"></span>
                <p> D </p> <br>
                <span class="dot" style="background-color:#fab91f;"></span>
                <p> E </p> <br>
                <span class="dot" style="background-color:#fa7108;"></span>
                <p> F </p> <br>
                <span class="dot" style="background-color:#ff0000;"></span>
                <p> G</p> <br>
                <span class="dot" style="background-color:#aaaaaa;"></span>
                <p> no data</p> <br>
            </div>


            <div id="dpeGES">
                <h3> DPE GES </h3>
                <br>
                <span class="dot" style="background-color:#f0eef6;"></span>
                <p> A </p> <br>
                <span class="dot" style="background-color:#dcdcec;"></span>
                <p> B </p> <br>
                <span class="dot" style="background-color:#c0c1de;"></span>
                <p> C </p> <br>
                <span class="dot" style="background-color:#a3a0cb;"></span>
                <p> D </p> <br>
                <span class="dot" style="background-color:#8683bd;"></span>
                <p> E </p> <br>
                <span class="dot" style="background-color:#6a51a3;"></span>
                <p> F </p> <br>
                <span class="dot" style="background-color:#582e92;"></span>
                <p> G</p> <br>
                <span class="dot" style="background-color:#aaaaaa;"></span>
                <p> no data</p> <br>
            </div>

            <div id="dateDPE">
                <h3> Date Notation GPE </h3>
                <br>
                <span class="dot" style="background-color:#f0eef6;"></span>
                <p> 2011 </p> <br>
                <span class="dot" style="background-color:#dcdcec;"></span>
                <p> 2012 </p> <br>
                <span class="dot" style="background-color:#c0c1de;"></span>
                <p> 2013 </p> <br>
                <span class="dot" style="background-color:#f7fbff;"></span>
                <p> 2014 </p> <br>
                <span class="dot" style="background-color:#d4e8fc;"></span>
                <p> 2015 </p> <br>
                <span class="dot" style="background-color:#8fc2de;"></span>
                <p> 2016 </p> <br>
                <span class="dot" style="background-color:#5ba3d0;"></span>
                <p> 2017</p> <br>
                <span class="dot" style="background-color:#3182be;"></span>
                <p> 2018 </p> <br>
                <span class="dot" style="background-color:#105ca5;"></span>
                <p> 2019 </p> <br>
                <span class="dot" style="background-color:#08306b;"></span>
                <p> 2020</p> <br>
                <span class="dot" style="background-color:#aaaaaa;"></span>
                <p> no data</p> <br>
            </div>

            <div id="consoTotalGas">
                <h3> Consommation totale de Gaz en 2020</h3>
                <br>
                <span class="dot" style="background-color:#ffe3e3;"></span>
                <p> 0 - 55000 litres/an </p> <br>
                <span class="dot" style="background-color:#ffaaaa;"></span>
                <p> 55001 - 200000 litres/an</p> <br>
                <span class="dot" style="background-color:#ff8e8e;"></span>
                <p> 200001 - 450000 litres/an </p> <br>
                <span class="dot" style="background-color:#ff5555;"></span>
                <p> 450001 - 1000000 litres/an </p> <br>
                <span class="dot" style="background-color:#ff0000;"></span>
                <p> 1000001 - 10000001 litres/an</p> <br>
                <span class="dot" style="background-color:#aaaaaa;"></span>
                <p> no data</p> <br>
            </div>

            <div id="consoTotalEnergy">
                <h3> Consommation totale kW/an en 2020 </h3>
                <br>
                <span class="dot" style="background-color:#ffe3e3;"></span>
                <p> 0 - 65000 kW/an </p> <br>
                <span class="dot" style="background-color:#ffaaaa;"></span>
                <p> 65001 - 200000 kW/an</p> <br>
                <span class="dot" style="background-color:#ff8e8e;"></span>
                <p> 200001 - 450000 kW/an </p> <br>
                <span class="dot" style="background-color:#ff5555;"></span>
                <p> 450001 - 900000 kW/an </p> <br>
                <span class="dot" style="background-color:#ff0000;"></span>
                <p> 900001 - 10000000 kW/an</p> <br>
                <span class="dot" style="background-color:#aaaaaa;"></span>
                <p> no data</p> <br>
            </div>
        </div>

        <div id="viewerDiv">

        </div>
    </div>
    <script src="node_modules/itowns/dist/itowns.js"></script>
    <script src="FeatureTooltip.js"></script>
    <script type="text/javascript">

        //retrieve view html container element
        const viewerDiv = document.getElementById('viewerDiv');
        let buttons = document.getElementById('buttons');
        let legend = document.getElementById('Legend');
        let hidden = document.getElementById('hidden');

        //defining projection coordinate unit
        itowns.proj4.defs(
            'EPSG:2154',
            '+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs'
        );

        //defining the views geographic extent, how far does it go
        const viewExtent = new itowns.Extent(
            'EPSG:2154',
            644500.0, 659499.99,
            6857500.0, 6867499.99,
        );

        //const view = new itowns.PlanarView(viewerDiv, viewExtent);

        //defining the cameras placement
        const placement = {
            coord: viewExtent.center(),
            tilt: 12,
            heading: 40,
            range: 3000,
        }

        //creating the planar view
        const view = new itowns.PlanarView(viewerDiv, viewExtent, {
            placement: placement,
        });

        //definin the source for the satellite color image  ortho-image
        const sourceOrtho = new itowns.WMSSource({
            url: "https://wxs.ign.fr/3ht7xcw6f7nciopo16etuqp2/geoportail/r/wms",
            name: "HR.ORTHOIMAGERY.ORTHOPHOTOS",
            format: 'image/png',
            crs: 'EPSG:2154',
            extent: viewExtent,
        });

        //defining the color layer, ortho-image
        const layerOrtho = new itowns.ColorLayer('Ortho', { source: sourceOrtho });
        // adding it to the view
        view.addLayer(layerOrtho);

        //defining the source of the ELevation model
        const sourceDEM = new itowns.WMSSource({
            url: "https://wxs.ign.fr/3ht7xcw6f7nciopo16etuqp2/geoportail/r/wms",
            name: "ELEVATION.ELEVATIONGRIDCOVERAGE.HIGHRES",
            format: "image/x-bil;bits=32",
            crs: 'EPSG:2154',
            extent: viewExtent,
        });

        //creating the elevation layer
        const layerDEM = new itowns.ElevationLayer('DEM', { source: sourceDEM });
        //adding it to the view
        view.addLayer(layerDEM);


        function setAltitude(properties) {
            if (properties.altitude_sol != null) {
                return properties.altitude_sol + properties.hauteur;
            } else {
                return 30;

            }
        }

        function setExtrusion(properties) {
            return properties.hauteur;
        }

        function setColor(properties) {

            return new itowns.THREE.Color(0xaaaaaa);
        }

        const batsource = new itowns.FileSource({
            url: './donnees/paris_centre.geojson',
            crs: 'EPSG:2154',
            format: 'application/json',
        });


        let basic = new itowns.FeatureGeometryLayer('basic', {
            // Use a FileSource to load a single file once
            source: batsource,
            transparent: true,
            opacity: 0.7,
            //zoom: { min: 10 },
            style: new itowns.Style({
                fill: {
                    color: setColor,
                    base_altitude: 28,
                    extrusion_height: setExtrusion,
                }
            })
        });

        //Change colors...
        function setColorDateConstruction(properties) {
            value = properties.periode_construction
            let dic = {
                '<1948': new itowns.THREE.Color(0xf7fcf5),
                '1949-1970': new itowns.THREE.Color(0xe2f4dd),
                '1970-1988': new itowns.THREE.Color(0xc0e6b9),
                '1989-1999': new itowns.THREE.Color(0x94d390),
                '2000-2005': new itowns.THREE.Color(0x60ba6c),
                '2006-2012': new itowns.THREE.Color(0x329b51),
                '>2012': new itowns.THREE.Color(0x277a3e)

            }

            if (dic[value] != null) {
                return dic[value];
            } else {
                return new itowns.THREE.Color(0xaaaaaa)
            }

        }
        let dateConstruction = new itowns.FeatureGeometryLayer('dateConstruction', {
            // Use a FileSource to load a single file once
            source: batsource,
            transparent: true,
            opacity: 0.7,
            //zoom: { min: 10 },
            style: new itowns.Style({
                fill: {
                    color: setColorDateConstruction,
                    base_altitude: 28,
                    extrusion_height: setExtrusion,
                }
            })
        });

        function setColorDpeEnergy(properties) {

            value = properties.classe_conso_ener
            let dic = {
                'A': new itowns.THREE.Color(0x009735),
                'B': new itowns.THREE.Color(0x00ff59),
                'C': new itowns.THREE.Color(0xa8fa2d),
                'D': new itowns.THREE.Color(0xf3fa25),
                'E': new itowns.THREE.Color(0xfab91f),
                'F': new itowns.THREE.Color(0xfa7108),
                'G': new itowns.THREE.Color(0xfa0000),
                'N': new itowns.THREE.Color(0xaaaaaa),
            }

            if (dic[value] != null) {
                return dic[value];
            } else {
                return new itowns.THREE.Color(0xaaaaaa)
            }

        }
        let dpeEnergy = new itowns.FeatureGeometryLayer('dpeEnergy', {
            // Use a FileSource to load a single file once
            source: batsource,
            transparent: true,
            opacity: 0.7,
            //zoom: { min: 10 },
            style: new itowns.Style({
                fill: {
                    color: setColorDpeEnergy,
                    base_altitude: 28,
                    extrusion_height: setExtrusion,
                }
            })
        });

        function setColorDpeGas(properties) {

            value = properties.classe_estim_ges
            let dic = {
                'A': new itowns.THREE.Color(0xf0eef6),
                'B': new itowns.THREE.Color(0xdcdcec),
                'C': new itowns.THREE.Color(0xc0c1de),
                'D': new itowns.THREE.Color(0xa3a0cb),
                'E': new itowns.THREE.Color(0x8683bd),
                'F': new itowns.THREE.Color(0x6a51a3),
                'G': new itowns.THREE.Color(0x582e92),
                'N': new itowns.THREE.Color(0xaaaaaa),
            }

            if (dic[value] != null) {
                return dic[value];
            } else {
                return new itowns.THREE.Color(0xaaaaaa)
            }

        }
        let dpeGES = new itowns.FeatureGeometryLayer('dpeGES', {
            // Use a FileSource to load a single file once
            source: batsource,
            transparent: true,
            opacity: 0.7,
            //zoom: { min: 10 },
            style: new itowns.Style({
                fill: {
                    color: setColorDpeGas,
                    base_altitude: 28,
                    extrusion_height: setExtrusion,
                }
            })
        });

        function setColorEnergyConso(properties) {
            value = properties.conso_tot


            if (value == 0) {

                return new itowns.THREE.Color(0xaaaaaa)
            }
            else if (value > 0 && value <= 65000) {
                return new itowns.THREE.Color(0xffe3e3)
            }
            else if (value > 65000 && value <= 200000) {
                return new itowns.THREE.Color(0xffaaaa)
            }
            else if (value > 200000 && value <= 450000) {
                return new itowns.THREE.Color(0xff8e8e)
            }
            else if (value > 450000 && value <= 900000) {
                return new itowns.THREE.Color(0xff5555)
            }
            else if (value > 900000 && value <= 10000000) {
                return new itowns.THREE.Color(0xff0000)
            } else {
                return new itowns.THREE.Color(0xaaaaaa)
            }
        }


        let consoTotalEnergy = new itowns.FeatureGeometryLayer('consoTotalEnergy', {
            // Use a FileSource to load a single file once
            source: batsource,
            transparent: true,
            opacity: 0.7,
            //zoom: { min: 10 },
            style: new itowns.Style({
                fill: {
                    color: setColorEnergyConso,
                    base_altitude: 28,
                    extrusion_height: setExtrusion,
                }
            })
        });


        function setColorGazConso(properties) {
            value = properties.conso_tot_2

            if (value == 0) {
                return new itowns.THREE.Color(0xaaaaaa)
            }
            else if (value > 0 && value <= 55000) {
                return new itowns.THREE.Color(0xffe3e3)
            }
            else if (value > 55000 && value <= 200000) {
                return new itowns.THREE.Color(0xffaaaa)
            }
            else if (value > 200000 && value <= 450000) {
                return new itowns.THREE.Color(0xff8e8e)
            }
            else if (value > 450000 && value <= 1000000) {
                return new itowns.THREE.Color(0xff5555)
            }
            else if (value > 1000000 && value <= 10000000) {
                return new itowns.THREE.Color(0xff0000)
            } else {
                return new itowns.THREE.Color(0xaaaaaa)
            }
        }


        let consoTotalGas = new itowns.FeatureGeometryLayer('consoTotalGas', {
            // Use a FileSource to load a single file once
            source: batsource,
            transparent: true,
            opacity: 0.7,
            //zoom: { min: 10 },
            style: new itowns.Style({
                fill: {
                    color: setColorGazConso,
                    base_altitude: 28,
                    extrusion_height: setExtrusion,
                }
            })
        });

        //change colors
        function setDPEdate(properties) {
            if (properties.date_reception_dpe != null) {
                value = properties.date_reception_dpe.substring(0, 4);

                switch (value) {
                    case '2013': return new itowns.THREE.Color(0xf7fbff);
                    case '2014': return new itowns.THREE.Color(0xf7fbff);
                    case '2015': return new itowns.THREE.Color(0xbed8ed);
                    case '2016': return new itowns.THREE.Color(0x8fc2de);
                    case '2017': return new itowns.THREE.Color(0x5ba3d0);
                    case '2018': return new itowns.THREE.Color(0x3182be);
                    case '2019': return new itowns.THREE.Color(0x105ca5);
                    case '2020': return new itowns.THREE.Color(0x08306b);
                    default: return new itowns.THREE.Color(0xaaaaaa);
                }

            } else {
                return new itowns.THREE.Color(0xaaaaaa)
            }
        }

        let dateDPE = new itowns.FeatureGeometryLayer('dateDPE', {
            // Use a FileSource to load a single file once
            source: batsource,
            transparent: true,
            opacity: 0.7,
            //zoom: { min: 10 },
            style: new itowns.Style({
                fill: {
                    color: setDPEdate,
                    base_altitude: 28,
                    extrusion_height: setExtrusion,
                }
            })
        });


        buttons.reset();
        let initialLayer = buttons.elements['layer'].value;
        buttons.addEventListener('change', changeLayer);
        let layers = [dateConstruction, dpeEnergy, dpeGES, dateDPE, consoTotalEnergy, consoTotalGas]
        view.addLayer(layers[initialLayer - 1]);
        legend.append(document.getElementById("dateConstruction"));
        let currentLayer = initialLayer;

        function changeLayer() {
            let choixLayer = buttons.elements['layer'].value;
            hidden.append(document.getElementById(layers[currentLayer - 1].id));
            view.removeLayer(layers[currentLayer - 1].id);

            let layerLegend = document.getElementById(layers[choixLayer - 1].id);
            legend.append(layerLegend)


            currentLayer = choixLayer;
            view.addLayer(layers[choixLayer - 1]);
        }
    </script>
</body>

</html>